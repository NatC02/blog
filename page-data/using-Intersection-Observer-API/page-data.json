{"componentChunkName":"component---src-templates-blog-post-js","path":"/using-Intersection-Observer-API/","result":{"data":{"site":{"siteMetadata":{"title":"Natan Ceballos Blog"}},"markdownRemark":{"id":"487f18bd-cfec-5c12-be1b-d9cb6a19275e","excerpt":"Native Intersection Observer API Implementation Intersection Observer API detects asynchonously whether an element is within the viewport of the screen. With…","html":"<h2>Native Intersection Observer API Implementation</h2>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">root</span><span class=\"token operator\">:</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#scrollArea'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">rootMargin</span><span class=\"token operator\">:</span> <span class=\"token string\">'0px 0px 0px 0px'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">threshold</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Intersection Observer API detects asynchonously whether an element is within the viewport of the screen. With the options object you can pass down how you want to implemement the API.</p>\n<p>root: Checks if the target element is in the viewport. <br/>\nrootMargin: Gives the root space and you could use CSS values (like “10px”). The format is: top, right, bottom, left. <br/>\nthreshold: A number or array values that represent the target elements visibility and when the callback for Intersection Observer should execute. For example: 50% mark would be “0.5”. <br/></p>\n<p>To observer the target:</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> target <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#listItem'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nobserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Since the callback is executed on the main thread when the threshold is met, resourcefulness is important.</p>\n<p>There’s alot that happens before a page loading and the main thread parser getting to invoke the API.</p>\n<br/>\n<h2><a href=\"https://www.speedshop.co/2015/11/05/page-weight-doesnt-matter.html\">Everything before the API is being called:</a></h2>\n<blockquote>\n<blockquote>\n<p>Browser opens connection to yoursite.com, does DNS/TCP/SSL setup.</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>Browser downloads the document (HTML).</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>Browser starts parsing the document. When the parser encounters a subresource, it opens a connection and downloads it. </p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>If the subresource is an external script tag, the parser stops, waits until it the script has downloaded, executes the entire script, and then moves on.</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>As soon as the parser stops and has to wait for an external script to download, it sends ahead something called a preloader. The preloader may notice and begin downloading resources if it understands how to (hint: a very popular Javascript pattern prevents this).</p>\n</blockquote>\n</blockquote>\n<!-- >> And Robert's your auntie's husband. -->\n<br/>\n<h2>You can preload all kinds of content using the <code class=\"language-text\">as</code> attribute with a link element:</h2>\n<ul>\n<li>audio: Audio file, as typically used in <code class=\"language-text\">&lt;audio></code>.</li>\n<li>document: An HTML document intended to be embedded by a <code class=\"language-text\">&lt;frame></code> or <code class=\"language-text\">&lt;iframe></code>.</li>\n<li>embed: A resource to be embedded inside an <code class=\"language-text\">&lt;embed></code> element.</li>\n<li>fetch: Resource to be accessed by a fetch or XHR request, such as an ArrayBuffer or JSON file.</li>\n<li>font: Font file.</li>\n<li>image: Image file.</li>\n<li>object: A resource to be embedded inside an <code class=\"language-text\">&lt;object></code> element.</li>\n<li>script: JavaScript file.</li>\n<li>style: CSS stylesheet.</li>\n<li>track: WebVTT file.</li>\n<li>worker: A JavaScript web worker or shared worker.</li>\n</ul>\n<br/>\n<h2><a href=\"https://www.gatsbyjs.com/docs/reference/built-in-components/gatsby-link/#replace-history-to-change-back-button-behavior\">How Gatsby uses Intersection Observer API</a></h2>\n<p>In Gatsby’s Link API, the Intersection Observer is used under the hood to bring fast page navigation. The <code class=\"language-text\">Link</code> component gives access to <strong>preloading</strong> the most important resources, and is one of the core pillars of ensuring web performance.</p>\n<p>When the current page has a <code class=\"language-text\">Link</code> component in the viewport the browser calls a low priority request to fetch the <code class=\"language-text\">Link</code>’s page. And a trigger is added (the callback) to switch to “high-priority” to fetch the page, if the mouse hovers over the link. </p>\n<h2>Other notable performance gains before the main parser thread</h2>\n<blockquote>\n<blockquote>\n<p>DNS Prefetch - Pretty simple - tell the browser to resolve the DNS of a given hostname (example.com) as soon as possible.</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>Preconnect - Tells the browser to open a connection as soon as possible to a given hostname. Not only will this resolve DNS, it will start a TCP handshake and perform TLS negotiation if the connection is SSL.</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>Prefetch - Tells to browser to download an entire resource (or subresource) that may be required later on. This resource can be an entire HTML document (for example, the next page of search results), or it can be a script, stylesheet, or other subresource. The resource is only downloaded - it isn’t parsed (if script) or rendered (if HTML).</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>Prerender - One of these things is not like the other, and prerender is it. Marking an <code class=\"language-text\">&lt;a></code> tag with prerender will actually cause the browser to get the linked href page and render it before the user even clicks the anchor! This is the technology behind Google’s Instant Pages and Facebook’s Instant Articles.</p>\n</blockquote>\n</blockquote>\n<p>I find it fascinating how native browser APIs are used across the web all for more performance. And how there are other factors that come before and during to improve performance. </p>\n<p>Below you can find my inspiration and more information about improving Browser Performance and Intersection Observer!</p>\n<h2>Resources:</h2>\n<ul>\n<li><a href=\"https://www.gatsbyjs.com/docs/reference/built-in-components/gatsby-link/#replace-history-to-change-back-button-behavior\">Gatsby Link API</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Link_types/preload#the_basics\">MDN Link Types</a></li>\n<li><a href=\"https://www.speedshop.co/2015/11/05/page-weight-doesnt-matter.html\">Page Weight Doesn’t Matter</a></li>\n</ul>","frontmatter":{"title":"Using Intersection observer API","date":"February 28, 2022","description":"What Intersection Observer is and web performance"}}},"pageContext":{"slug":"/using-Intersection-Observer-API/","previous":{"fields":{"slug":"/why-I-will-be-playing-total-war-warhammer-II/"},"frontmatter":{"title":"Why Total War Warhammer III (sometime this year)"}},"next":{"fields":{"slug":"/increasing-network-utilization/"},"frontmatter":{"title":"Increasing Network Utilizationby"}}}},"staticQueryHashes":["2915217059","805692932"]}